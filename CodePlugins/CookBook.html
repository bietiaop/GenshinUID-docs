<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>插件开发指南 | 早柚核心Docs</title>
    <meta name="description" content="安装早柚核心、了解早柚协议、编写GsCore插件，早柚核心，一个可以连接多个Bot和适配多个平台的Python Bot框架。">
    <meta name="generator" content="VitePress v1.3.3">
    <link rel="preload stylesheet" href="/assets/style.D-z9-E_Y.css" as="style">
    
    <script type="module" src="/assets/app.BjJt4kE0.js"></script>
    <link rel="modulepreload" href="/assets/chunks/theme.Dd7k7j-1.js">
    <link rel="modulepreload" href="/assets/chunks/framework.AIsPoTDm.js">
    <link rel="modulepreload" href="/assets/chunks/ChatMessage.vue_vue_type_style_index_0_lang.DTkzfQyS.js">
    <link rel="modulepreload" href="/assets/chunks/PageInfo.vue_vue_type_script_setup_true_lang.D3Jit8bU.js">
    <link rel="modulepreload" href="/assets/chunks/Badge.Gth0UqrR.js">
    <link rel="modulepreload" href="/assets/CodePlugins_CookBook.md.DK-gTg6O.lean.js">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="Dcos，GsCore，早柚核心，GenshinUID，机器人插件，NoneBot2，onebot，HoshinoBot，YunzaiBot，Koishi，ZeroBot，Plugins，Bot，原神机器人，星铁机器人，方舟机器人，游戏机器人，蔚蓝档案机器人，QQ群，QQ频道，KOOK，Telegram，Discord，飞书。">
    <meta name="author" content="Wuyi">
    <meta property="og:type" content="article">
    <meta name="application-name" content="早柚核心Docs">
    <meta name="apple-mobile-web-app-title" content="早柚核心Docs">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="mask-icon" href="/favicon.ico" color="#06f">
    <meta name="theme-color" content="#06f">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon.png">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" crossorigin="anonymous" href="https://fonts.googleapis.com">
    <link rel="preconnect" crossorigin="anonymous" href="https://fonts.gstatic.com">
    <meta property="og:description" content="安装早柚核心、了解早柚协议、编写GsCore插件，早柚核心，一个可以连接多个Bot和适配多个平台的Python Bot框架。">
    <meta property="og:url" content="https://docs.gsuid.gbots.work/">
    <meta property="og:locale" content="zh_CN">
    <script async defer data-website-id="" src=""></script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <link rel="preload" href="/assets/image-20240601033727344.D1a80o-n.png" as="font" type="font/woff2" crossorigin="">
    <link rel="manifest" href="/manifest.webmanifest">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-ab179fa1><a class="title" href="/" data-v-ab179fa1><!--[--><!--]--><!--[--><img class="VPImage logo" src="/favicon.ico" alt data-v-8426fc1a><!--]--><span data-v-ab179fa1>早柚核心Docs</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-dc692963 data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>🎉 快速开始</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-b98bc113><div class="items" data-v-b98bc113><!--[--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link" href="/Started/InstallCore.html" data-v-43f1e123><!--[-->⭐ 安装Core<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link" href="/LinkBots/AdapterList.html" data-v-43f1e123><!--[-->🤖 链接Bot<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link" href="/InstallPlugins/InstallPlugins.html" data-v-43f1e123><!--[-->🔧 安装插件<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link" href="/Advance/BindDevice.html" data-v-43f1e123><!--[-->✅ 绑定账号<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link" href="/FAQ/" data-v-43f1e123><!--[-->💫 常见问题<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link" href="/CodePlugins/Start.html" data-v-43f1e123><!--[-->💻 编写插件<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link" href="/CodeAdapter/Pack.html" data-v-43f1e123><!--[-->🧐 编写适配器<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-dc692963 data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>💖 系列插件</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-b98bc113><div class="items" data-v-b98bc113><!--[--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/KimigaiiWuyi/GenshinUID" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->✨ GenshinUID<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/baiqwerdvd/StarRailUID" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->🚅 StarRailUID<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/KimigaiiWuyi/WzryUID" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->🎮 WzryUID<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/baiqwerdvd/ArknightsUID/" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->🛶 ArknightsUID<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/KimigaiiWuyi/BlueArchiveUID" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->🏫 BlueArchiveUID<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/KimigaiiWuyi/MajsoulUID" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->🀄 MajsoulUID<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/KimigaiiWuyi/LOLegendsUID" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->🦸‍♂️ LOLegendsUID<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/ZZZure/ZZZeroUID" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->🧿 ZZZeroUID<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link" href="/InstallPlugins/PluginsList.html" data-v-43f1e123><!--[-->⏩ 更多插件<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-dc692963 data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>v0.2.1</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-b98bc113><div class="items" data-v-b98bc113><!--[--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/Genshin-bots/GenshinUID-docs" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->📝 文档地址<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/Genshin-bots/gsuid_core" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->📦️ GsCore地址<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://qm.qq.com/cgi-bin/qm/qr?k=d1oNQ1wePPbCkhPbP3vZN-DsXDD0hG61&amp;authKey=0PdxKz%2BMbWgy7kwcF9OB%2B%2BrgOWKuREFG6tgJuWpr%2BzN8gtBTlGR6wDbk6N0W3bL1&amp;noverify=0&amp;group_code=929275476" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->🐧 QQ群: Mihomo Group<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>外观</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>归档</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>🚀 快速开始</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Started/EnvCheck.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>确认环境</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Started/InstallCore.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>安装GsCore</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Started/StartCore.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>启动GsCore</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Started/CoreConfig.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>配置GsCore</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0> 🤖 链接支持Bot</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/LinkBots/NoneBot2.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>NoneBot2</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/LinkBots/HoshinoBot.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>HoshinoBot</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/LinkBots/AdapterList.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>适配Bot列表</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>🔧 安装插件</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/InstallPlugins/InstallPlugins.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>安装插件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/InstallPlugins/PluginsList.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>插件列表</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0> 🚀 进阶介绍</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Advance/BaseInfo.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>概念理解</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Advance/DataStruct.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>数据存储结构</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Advance/WebConsole.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>网页控制台</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/FAQ/" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>常见问题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Advance/BindDevice.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>绑定账号</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Advance/TransURL.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>转URL图片发送</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Advance/MarkdownTemplate.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>MD模板和按钮模板</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Advance/CoreConfig.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Core配置项</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/Advance/HTTPCall.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>HTTP调用</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible has-active" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0> 🔍️ 编写插件</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/Start.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>✨ 简单介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/CookBook.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>🔥 插件开发指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/Env.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>VsCode配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/Simple.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>简单示例</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/Exsample.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>简单参考</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/Scheduler.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>定时任务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/GetDataPath.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>调用资源目录</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/PluginsConfig.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>提供配置项</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/GetPluginsConfig.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>调用配置项</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/PluginsDataBase.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>调用数据库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/Resp.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>多步会话</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/BotCall.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>任意位置调用Bot</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodePlugins/Class.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>模块方法</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0> 🧐 编写适配器</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodeAdapter/Protocol.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>早柚协议</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/CodeAdapter/Pack.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>数据结构</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0> 📄 插件帮助</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/PluginsHelp/GenshinUID.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>GenshinUID</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/PluginsHelp/StarRailUID.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>StarRailUID</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/PluginsHelp/ArknightsUID.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>ArknightsUID</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/PluginsHelp/BlueArchiveUID.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>BlueArchiveUID</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/PluginsHelp/WzryUID.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>WzryUID</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/PluginsHelp/MajsoulUID.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>MajsoulUID</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/PluginsHelp/LOLegendsUID.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>LOLegendsUID</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/PluginsHelp/ZZZeroUID.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>ZZZeroUID</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>导航栏</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _CodePlugins_CookBook" data-v-39a288b8><div><h1 id="插件开发指南" tabindex="-1">插件开发指南 <span class="VPBadge tip" data-v-d01e489a><!--[-->普通<!--]--></span> <a class="header-anchor" href="#插件开发指南" aria-label="Permalink to &quot;插件开发指南 &lt;Badge type=&quot;tip&quot; text=&quot;普通&quot; /&gt;&quot;">​</a></h1><div><section class="border-b-1 border-[var(--vp-c-divider)] w-full border-b-solid mt-[24px] pb-[12px] flex gap-[12px] mb-[12px] flex-wrap max-w-[85%]"><div class="flex gap-[4px] items-center"><svg style="display:inline-block;" viewBox="0 0 16 16" width="1.2em" height="1.2em"><path fill="currentColor" d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M5.485 6.879l1.036 4.144l.997-3.655a.5.5 0 0 1 .964 0l.997 3.655l1.036-4.144a.5.5 0 0 1 .97.242l-1.5 6a.5.5 0 0 1-.967.01L8 9.402l-1.018 3.73a.5.5 0 0 1-.967-.01l-1.5-6a.5.5 0 1 1 .97-.242z"></path></svg> 字数统计:<span>6.3k 字</span></div><div class="flex gap-[4px] items-center"><svg style="display:inline-block;" viewBox="0 0 20 20" width="1.2em" height="1.2em"><path fill="currentColor" d="M10 0a10 10 0 1 0 10 10A10 10 0 0 0 10 0m2.5 14.5L9 11V4h2v6l3 3z"></path></svg> 阅读时长:<span>21 分钟</span></div></section></div><div class="tip custom-block"><p class="custom-block-title">💡 提醒</p><ul><li><p>🎉 该文档将从最基础的创建项目结构开始，直至创建一个<strong>能正常使用功能</strong>的GsCore插件。</p><ul><li><p>包含基础的命令调用、配置文件持久化、数据库存读、网页控制台...等等！</p></li><li><p>得益于GsCore众多的内置函数接口，该教程完成的插件功能完成度很高，而教程长度并不长！</p></li></ul></li><li><p>🤗 该文档适用于<strong>任何人</strong>，哪怕<em>你没有最基本的Python知识</em>，也能通过该文档进行<strong>学习</strong>。</p><ul><li>但是你需要拥有基本的<strong>耐心</strong>，一颗善于<strong>学习的心</strong>、以及最基本的<strong>互联网查找技能</strong></li></ul></li></ul></div><h2 id="_0、在开始前" tabindex="-1">0、在开始前 <a class="header-anchor" href="#_0、在开始前" aria-label="Permalink to &quot;0、在开始前&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">📝 备注</p><p>在编写代码开始前，请先确保你安装了<strong>最基本的环境</strong>。</p><p>注意：以下说的是你的本地开发环境，而非Bot部署环境（服务器）</p></div><ul><li><p>🛠 你已经通过<a href="/Started/EnvCheck.html">该文档</a>安装并检查了如下工具：</p><ul><li><strong>Python</strong> 3.8及以上（建议3.11）</li><li>git</li><li>poetry/pdm <ul><li>注意：本次教程<strong>将会使用</strong><code>PDM</code>作为项目(包)管理工具，poetry操作类似但略有不同</li></ul></li></ul></li><li><p>🚀 你已经通过<a href="/Started/InstallCore.html">该教程</a>安装并成功<a href="/Started/StartCore.html">运行</a>本项目，即<strong>GsCore正常运行</strong></p></li><li><p>🤖 你已经<strong>成功</strong>运行任何一个Bot端和服务端，并能使用IM软件与你的Bot进行对话</p><ul><li><strong>Bot端</strong>：NoneBot2、HoshinoBot、Koishi、Yunzai、等等.....</li><li><strong>协议端</strong>：Go-CQHTTP、NapCat、或者某些Bot自带的协议适配器、等等.....</li><li><strong>IM软件</strong>：QQ、QQ频道、Discord、Telegram、KOOK、DODO、微信、等等.....</li><li><strong>和Bot对话</strong>：发送命令<code>core状态</code>，Bot能够正确进行回复</li></ul></li><li><p>⌨ 安装任意一个代码编辑器，这里推荐<strong>VSC</strong>，也就是<a href="https://code.visualstudio.com/" target="_blank" rel="noreferrer">Visual Studio Code</a></p><ul><li>当然你也可以选择使用<em>PyCharm</em>，但以下内容<strong>将以VSC为范例</strong>。</li></ul></li></ul><h2 id="_1、明确项目需求" tabindex="-1">1、明确项目需求 <a class="header-anchor" href="#_1、明确项目需求" aria-label="Permalink to &quot;1、明确项目需求&quot;">​</a></h2><p>本次我们的任务目标，是编写一个经典的<strong>天气插件</strong>，该插件拥有两个命令：</p><ul><li>以漳州为例，当用户发送<code>漳州天气</code>或者<code>天气漳州</code>，机器人将发送该城市的天气</li><li>用户可以发送<code>绑定城市漳州</code>，之后下次用户可以直接发送<code>天气</code>进行查询<code>漳州</code>天气，无需额外输入 <ul><li>如果用户没有绑定任何城市，发送<code>天气</code>需要默认查询北京天气</li><li>支持多个城市绑定，假设用户发送<code>绑定城市漳州</code>和<code>绑定城市福州</code>两个命令，即绑定漳州、福州两个城市，下次用户发送<code>天气</code>时，将自动发送两个城市的今日天气</li></ul></li></ul><h2 id="_2、创建项目结构" tabindex="-1">2、创建项目结构 <a class="header-anchor" href="#_2、创建项目结构" aria-label="Permalink to &quot;2、创建项目结构&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">📝 备注</p><p>尽管我们这次的任务目标<strong>很简单</strong>，但在编写代码开始前，</p><p><strong>做好项目结构规划</strong>是必不可少的，养成良好习惯很<strong>重要</strong>。</p></div><div class="tip custom-block"><p class="custom-block-title">💡 提醒</p><p>在GsCore中，插件将会被放置在<code>/gsuid_core/plugins</code><strong>目录</strong>下</p></div><ol start="0"><li><p>打开命令行工具，检查路径是否在插件目录下</p></li><li><p>如果不在，键入命令<code>cd gsuid_core/plugins</code>可能有用（命令<code>cd</code>后跟路径可移动当前命令行工作目录）</p></li><li><p>在<code>plugins</code>目录下创建一个文件夹，命名为<strong>gs_weather</strong></p></li><li><p>进入该文件夹，确保路径（<code>gsuid_core/plugins/gs_weather</code>）正确之后，使用命令<code>pdm init</code></p><ol><li><p>在这一步会有许多的交互式命令，要求你输入一些关于你项目的信息</p><ul><li>💡输入y回车代表<strong>是</strong>，输入n回车代表<strong>否</strong>；部分问题需要直接输入信息</li></ul></li><li><p>按照流程走完创建初始化（下面会提供一些问题的参考）。</p><ul><li><p>💻 Would you like to create a virtualenv with <em>balabalabala......</em></p><ul><li>该问题是在询问你是否创建一个关于你项目的<strong>虚拟环境</strong>，这里输入<strong>n</strong>回车</li></ul></li><li><p>💻 Project name (plugins)：</p><ul><li>该问题是在询问<strong>你的项目名称</strong>，也会作为你的文件夹名称，这里输入<strong>gs_weather</strong>回车</li></ul></li><li><p>💻 Project version (0.1.0)：</p><ul><li>该问题是在询问<strong>你的项目版本号</strong>，这里我们直接回车，代表填入默认值<strong>0.1.0</strong></li></ul></li><li><p>💻 Do you want to build this project for distribution(such as wheel)?</p><ul><li>直接回车，代表填入默认值<strong>n</strong></li></ul></li><li><p>💻 License(SPDX name)：</p><ul><li>该问题是在询问<strong>你的项目发布许可</strong>，直接回车代表填入默认值<strong>MIT</strong><ul><li>也可以选<strong>GPL-3.0</strong>或者其他，具体可以百度，建议直接默认</li></ul></li></ul></li><li><p>💻 Author name (<em>balbala</em>)：</p><ul><li>该问题是在询问你（作者）的<strong>名称</strong>，<em>可以手动填入</em><ul><li>如果你已经完成git的配置，括号里默认就是你git的名字，直接回车即可</li></ul></li></ul></li><li><p>💻 Author email (balbala)：</p><ul><li>该问题是在询问你（作者）的<strong>邮箱地址</strong>，<em>可以手动填入</em><ul><li>如果你已经完成git的配置，括号里默认就是你的邮箱，直接回车即可</li></ul></li></ul></li><li><p>💻 Python requires(&#39;*&#39; to allow any) (==3.11.*)：</p><ul><li>该问题是在询问你的项目需要什么<strong>Python版本</strong>，这里根据<strong>实际情况</strong>填写 <ul><li>如果不确定，可以填入**&gt;=3.9**</li></ul></li></ul></li></ul></li></ol></li><li><p>完成初始化之后，我们检查<code>gs_weather</code>文件夹内是否<strong>成功生成一些文件&amp;文件夹</strong></p></li><li><p>这里我们需要<strong>手动修改</strong>一下文件夹结构，注意到文件夹内应该有<code>src</code>文件夹</p><ul><li>这里将<code>src</code>文件夹内的<code>gs_weather</code>文件夹直接移动到<code>src</code>文件夹外</li><li>然后删除<code>src</code>文件夹</li><li>再次进入<code>gs_weather</code>文件夹内，注意到里面应该有默认的<code>__init__.py</code>文件</li></ul></li><li><p>重新启动GsCore，发现命令行存在如下输出，代表我们的插件项目<strong>成功创建</strong>完成了！</p></li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">06-01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 03:29:51</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [DEBUG] gsuid_core.server </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 导入gs_weather中...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">06-01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 03:29:51</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [SUCCESS] gsuid_core.server </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 插件gs_weather导入成功!</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_3、开始编写代码" tabindex="-1">3、开始编写代码 <a class="header-anchor" href="#_3、开始编写代码" aria-label="Permalink to &quot;3、开始编写代码&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">💡 提醒</p><p>首先打开<strong>VSC</strong>，注意一定要选择<strong>打开文件夹</strong>，然后选择顶层的<strong>gs_weather</strong>文件夹。</p><p>此时的项目结构（注意观察文件夹树），应该如下图所示，</p><p>我们导航到<code>gs_weather/__init__.py</code>下，开始编写我们的业务代码。</p><p><strong>注意</strong>：以下的代码如果实在无法理解是什么意思，你可以先抄入VSC中，后续再一行一行的理解</p></div><img src="/assets/image-20240601033727344.D1a80o-n.png" alt="image-20240601033727344"><ol><li>导入<code>gsuid_core</code>的基本库，这里我们需要在<code>__init__.py</code>下写入以下代码，代表引用下面的库</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 井号后面的字符代表注释和解释，不参与实际的代码功能，下文将不再提醒</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.sv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SV</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.bot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Bot</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.models </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Event</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>以第一行为例，<code>from gsuid_core.sv import SV</code>代表从<code>gsuid_core</code><strong>库</strong>的<code>sv</code><strong>模块</strong>导入了一个<strong>类</strong><code>SV</code></li><li>目前我们不需要关注<strong>SV</strong>、<strong>Bot</strong>、<strong>Event</strong>这三个类的具体含义，在下面将会逐一介绍</li></ul><ol start="2"><li><p>创建一个<strong>服务</strong>，该服务将会控制很多不同的<strong>触发器</strong>，换言之，控制不同的插件<strong>命令</strong></p><ul><li><p>什么是命令？：<strong>命令</strong>代表机器人的功能，例如<code>天气</code>就是一个<strong>命令</strong></p></li><li><p>什么是触发器？：触发器即代表<strong>命令</strong>的触发方式，例如<strong>前置触发</strong>（即<code>天气漳州</code>），还是<strong>后置触发</strong>（即<code>漳州天气</code>），以及更多的触发方式，将会在后面的文档提到。</p></li></ul></li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这里我们创建了一个 天气信息查询 的【服务】，即SV(&#39;天气信息查询&#39;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将SV(&#39;天气信息查询&#39;)对象赋予gs_weather_info，方便后续调用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gs_weather_info </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SV(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气信息查询&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>编写<strong>业务代码</strong>，也就是天气查询服务，这里我们先用一段简单的代码占位，在下一节，再编写实际功能。</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 以async def开头创建一个函数，函数名为 send_weather_msg</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 该函数接受两个参数，bot和ev，参数类型分别是Bot和Event，这里如果没理解意思可以照抄</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_weather_msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bot: Bot, ev: Event):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 当函数运行到这一行的时候，发送下面的回复</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[漳州天气] 今日的天气是66度，烫死人了！&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="4"><li>创建一个<strong>触发器</strong>，也就是实际的命令，这里需要注意，触发器将以<strong>装饰器</strong>的形式提供 <ul><li>什么是装饰器？：这块可能比较难以理解，暂时可以先硬记下来语法，日后有兴趣再深入</li><li>装饰器的语法：以@开头，<strong>一般</strong>直接加在函数定义的上一行，具体看如下代码</li></ul></li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在我们刚刚编写的业务代码上，加上一行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># @gs_weather_info代表刚刚创建的服务，在之后加入点.代表调用触发器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># @gs_weather_info.on_command代表了调用`on_command`触发器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># `on_command`需要接受一个参数，传入我们希望的命令文字即可，这里我们填入命令`天气`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@gs_weather_info.on_command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_weather_msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bot: Bot, ev: Event):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[漳州天气] 今日的天气是66度，烫死人了！&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="5"><li>看一下我们写的完整的代码，结合注释，一行一行的理解一下，是不是非常的简单！</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.sv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SV</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.bot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Bot</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.models </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Event</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gs_weather_info </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SV(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气信息查询&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@gs_weather_info.on_command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">block</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_weather_msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bot: Bot, ev: Event):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[漳州天气] 今日的天气是66度，烫死人了！&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="6"><li>代码范例截图</li></ol><img src="/assets/image-20240601194410390.CVXzRM7a.png" alt="image-20240601194410390"><ol start="7"><li>实际运行一下<strong>GsCore</strong>，向Bot发送<code>天气</code>，观察Bot是否正常回复消息。</li></ol><div class="panel-view"><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><span class="title-text">聊天界面</span></div></div><div class="content"><!--[--><div class="chat-message"><img class="avatar" src="https://s2.loli.net/2023/10/05/GHjJNWBP4nezgIU.png"><div class="nickname">Wuyi无疑 <span class="VPBadge danger" data-v-d01e489a><!--[-->用户<!--]--></span></div><div class="message-box"><!--[-->天气<!--]--></div></div><div class="chat-message"><img class="avatar" src="https://s2.loli.net/2023/03/25/bareSdYcsmRPOyZ.png"><div class="nickname">GsCore <span class="VPBadge tip" data-v-d01e489a><!--[-->机器人<!--]--></span></div><div class="message-box"><!--[-->[漳州天气] 今日的天气是66度，烫死人了！<!--]--></div></div><!--]--></div></div><h2 id="_4、完善业务代码" tabindex="-1">4、完善业务代码 <a class="header-anchor" href="#_4、完善业务代码" aria-label="Permalink to &quot;4、完善业务代码&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">💡 提醒</p><p>在上一节中，我们基本已经完成了一个插件的基本结构，</p><p>剩下的就是实际的业务代码部分了，</p><p>也就是如何把Bot的<em>固定回复</em>，转为<strong>真正的</strong>，根据用户<strong>传入天气</strong>，进行<strong>动态的回复</strong>。</p></div><ol><li>首先，需要获得一个天气的<strong>API接口</strong>，这里我们选择<a href="https://id.qweather.com/#/login" target="_blank" rel="noreferrer">和风天气</a>，按照页面介绍注册并登陆。 <ul><li>什么是API接口？：在网页中，API<strong>一般</strong>代表某个<strong>URL</strong>地址，通过<strong>网络请求</strong>，可以通过API得到一定返回。</li><li>例如在本次例子中，访问和风天气API，将会得到城市的天气信息<strong>返回</strong>。</li><li>我们利用这个返回值，做成我们机器人的插件即可。</li></ul></li><li>登陆成功后，我们需要创建一个开发者key，下滑找到和风天气的<a href="https://console.qweather.com/#/console" target="_blank" rel="noreferrer">开发服务控制平台</a>。 <ul><li>在右侧的<strong>我的项目</strong>中，我们点击创建即可。</li><li><strong>项目名称</strong>：随意填写</li><li><strong>订阅</strong>：免费订阅</li><li><strong>设置Key</strong>：WebAPI</li><li><strong>Key的名称</strong>：随意</li><li>点击<strong>创建</strong>即可。</li><li>返回项目管理，可以看到自己的Key列表，点击查看即可</li><li>复制好Key内容，留作备用。</li></ul></li></ol><img src="/assets/image-20240601220233918.BmzA14tD.png" alt="image-20240601220233918"><ol start="3"><li>阅读和风天气的<a href="https://dev.qweather.com/docs/start/" target="_blank" rel="noreferrer">开发者文档</a>（这里你可以先不用读，我会列出本次项目需要用的API） <ul><li>测试一下API接口</li><li><a href="https://devapi.qweather.com/v7/weather/now?location=101010100&amp;key=" target="_blank" rel="noreferrer">https://devapi.qweather.com/v7/weather/now?location=101010100&amp;key=</a></li><li>将上面获得的<strong>key</strong>输入上一行<strong>URL</strong>的后面，然后在浏览器中直接回车请求</li><li>不出意外的话，你可以看到正常打开了网页，其中<code>code</code>值为200，代表<strong>成功请求</strong></li></ul></li></ol><img src="/assets/image-20240601220452874.vHbddWKS.png" alt="image-20240601220452874"><ol start="4"><li><p>理解业务代码请求逻辑，捋一遍如下：</p><ul><li>用户对机器人发送<strong>天气漳州</strong></li><li>机器人获得<strong>漳州</strong>关键字，然后<strong>请求</strong>和风天气API，得到<strong>城市代码</strong></li><li>利用<strong>城市代码</strong>，<strong>请求</strong>和风天气API，得到<strong>天气数据</strong></li><li><strong>数据处理</strong>之后，转为文字，由Bot<strong>发送</strong></li></ul></li><li><p>编写代码，这里直接给出完整代码，并给予了相应<strong>注释</strong>，可以自行查看：</p></li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.sv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SV</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.bot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Bot</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.models </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Event</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 导入httpx的网络请求模块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> httpx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gs_weather_info </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SV(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气信息查询&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在这里填入你自己的KEY码，在Python中，字符串使用单引号，双引号，三引号都可以。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这里的KEY已经失效，请申请自己的KEY使用！</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;21e050d859ce4d6c992d23bb4f53e58a&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这里我们额外添加一个触发器`on_suffix`，这个触发器用于在末尾触发命令</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 加上之后，该触发器会响应用户的`漳州天气`指令，而不是只响应`天气漳州`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@gs_weather_info.on_suffix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">block</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@gs_weather_info.on_command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">block</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_weather_msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bot: Bot, ev: Event):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 获取用户输入的城市，如果为空，做出提醒，并用return中断函数运行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ev.text.strip()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;请输入城市名称！&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 创建一个请求客户端</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> httpx.AsyncClient()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 根据用户传入的信息，请求城市ID和城市完整名称</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ev是当前事件的一系列可用信息，例如ev.text就是去除了命令之后的用户输入</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 例如用户输入 天气漳州 ，ev.text = 漳州</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 要获取完整用户输入，ev.raw_text = 天气漳州，ev.command = 天气</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pos_resp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.get(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;https://geoapi.qweather.com/v2/city/lookup&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: text,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 解析结果为pyhon中的字典</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pos_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_resp.json()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 获取结果中的响应代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pos_retcode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 响应码不为200则发生了报错，我们把错误码返回给用户，便于定位错误信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_retcode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;200&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[天气] 获取天气信息失败！错误码为 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pos_retcode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 城市ID，就是要用这个ID请求下面的天气信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pos_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 城市名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pos_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 再进行一次请求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        weather_resp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.get(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;https://devapi.qweather.com/v7/weather/now&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: pos_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        weather_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_resp.json()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        weather_retcode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 错误码处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;200&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[天气] 获取天气信息失败！错误码为 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">weather_retcode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">！&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 现在温度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            now_temp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;now&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;temp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 现在的体感温度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            now_feels </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;now&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;feelsLike&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 将结果进行字符串拼贴，便于把最后的结果呈现给用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pos_name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">的天气是：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">now_temp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">度, 体感温度为: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">now_feels</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">度！&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(text)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><h2 id="_5、增强用户体验" tabindex="-1">5、增强用户体验 <a class="header-anchor" href="#_5、增强用户体验" aria-label="Permalink to &quot;5、增强用户体验&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">📝 备注</p><p>做到这里，现在我们已经基本实现<strong>目标一</strong>了！</p><p>但是现在每次用户想要查询天气，都需要输入自己所在地城市，</p><p>这似乎有点不方便，我们希望通过<strong>绑定城市</strong>命令，</p><p>为每个用户绑定他专属的城市，下次他只需要再输入<code>天气</code>即可查询自己城市的天气。</p></div><ol start="0"><li>这就需要<strong>持久化存储</strong>用户输入的数据，一般我们使用<strong>数据库</strong>或者<strong>Json</strong>文件，甚至是TXT文件。 <ul><li><strong>持久化存储</strong>相当于一个游戏存档，下次面对<strong>相同用户</strong>我们可以读取上次他使用过的数据</li><li>本次我们使用<strong>数据库</strong>，数据库相比json、txt文件一般来说性能<strong>更好</strong>，但代码要求也会<strong>更高</strong></li><li>借助GsCore库中自带的<strong>数据库基类</strong>，我们可以很轻松的使用数据库</li><li>首先新建一个文件，命名为<code>database.py</code>，我们在这里面编写相关部分</li></ul></li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Optional</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sqlmodel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Field</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从gsuid_core库的utils模块导入预先编写好的数据库基类</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这些基类能帮助你快速完成你的业务实现</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.utils.database.base_models </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Bind</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建一个类（在此时相当于数据库），继承基类Bind</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注意, 这里要添加 table=True 的参数，如果不添加，就不是建立表，而是单纯的继承</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WeatherBind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">table</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 这里的uid是基类定义好的，沿用下来可以轻松调用预先编写好的方法，例如获取全部、切换、删除、添加。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 在这里uid即是我们用户需要绑定的城市</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uid: Optional[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Field(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;城市&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><img src="/assets/image-20240609005228562.DqVU8Jty.png" alt="image-20240609005228562"><ol><li>返回<code>__init__.py</code>，在开头导入部分导入我们新建<code>database</code>模块中的<code>WeatherBind</code>类</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .database </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WeatherBind</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>然后我们继续沿用<code>gs_weather_info</code>服务，在下面创建一个<strong>触发器</strong><ul><li>为了避免和其他插件可能的<code>绑定</code>命令冲突，这里最好加上前缀, 比如<code>tq</code></li></ul></li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@gs_weather_info.on_command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tq绑定城市&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bind_city</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bot: Bot, ev: Event):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pass</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>在<code>bind_city</code>中创建实际的代码</li><li>以下为代码展示，依旧包含了相对应的注释，如果看不懂可以一行一行慢慢看。</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@gs_weather_info.on_command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tq绑定城市&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bind_city</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bot: Bot, ev: Event):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 获取用户输入的城市，如果为空，做出提醒，并用return中断函数运行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ev.text.strip()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;请输入城市名称！&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 进行一次请求，我们只需要存储最后的城市ID即可</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> httpx.AsyncClient()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pos_resp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.get(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;https://geoapi.qweather.com/v2/city/lookup&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: text,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pos_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_resp.json()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pos_retcode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 如果根据用户输入，无法找到对应城市，则发出提醒</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_retcode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;200&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;你输入的城市不存在, 请检查输入是否有误!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 获取城市ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pos_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pos_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 这里我们要稍微处理一下ID，让他和城市名称组合再一起，然后再插入数据库</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ！因为之后我们还要用到城市名称！</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 这里我习惯用|进行分割</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        uuid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pos_name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pos_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 然后把处理后的数据插入数据库，和UserID相对应</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 这个内置函数可以接受多个ID的插入，方便后续多绑定</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WeatherBind.insert_uid(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ev.user_id, ev.bot_id, uuid, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">is_digit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;绑定城市 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pos_name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 成功！&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>在这里，由于继承了<strong>GsCore</strong>中的<strong>基类数据库</strong>，这里有很多<strong>已经写好的方法</strong>，方便你调取</p><p>善于利用VSC的<strong>提示</strong>功能，根据<strong>函数名</strong>意思，应该能猜出来大部分函数的对应用法，</p><p>每个函数，更提供了<strong>非常详尽的注释</strong>，方便你<strong>专心于业务功能</strong>。</p><img src="/assets/image-20240609010120469.BEgBJIKB.png" alt="image-20240609010120469"><p>上图为<strong>代码提示</strong>，下图为<strong>函数注释</strong></p><img src="/assets/image-20240609010309426.BQVHXZVy.png" alt="image-20240609010309426"></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>💡由于默认的<code>Bind</code>, <code>User</code>等基类表带有强烈的游戏风格命名。</p><p>例如<code>uid</code>, <code>get_data_by_uid</code>等等...</p><p>如果你不想使用默认的基类表，也可以自己创建表，并编写自己基类的静态方法！</p><p>示例在<a href="./PluginsDataBase.html">这里</a>，往下拉的【额外、继承Base_Model】章节中！</p></div><ol start="5"><li>我们紧接着完成<code>tq删除绑定城市</code>，代码如下</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@gs_weather_info.on_command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tq删除绑定城市&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> unbind_city</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bot: Bot, ev: Event):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 获取当前激活的城市ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pos_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WeatherBind.get_uid_by_game(ev.user_id, ev.bot_id)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 如果存在绑定</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 则删除当前激活的ID</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WeatherBind.delete_uid(ev.user_id, ev.bot_id, pos_id)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 不要忘了我们的pos_id是 城市名|城市id的组合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        city_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_id.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;|&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 然后发出消息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;删除城市 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">city_name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 成功！&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 如果不存在，则发出相应提示</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 调用bot发送消息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;你还没有绑定任何城市噢！请使用 [tq绑定城市] 命令进行绑定！&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol start="6"><li>接着我们回到最开始的<code>天气</code>命令，完成调用，代码如下</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这里我们额外添加一个触发器`on_suffix`，这个触发器用于在末尾触发命令</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 加上之后，该触发器会响应用户的`漳州天气`指令，而不是只响应`天气漳州`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@gs_weather_info.on_suffix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">block</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@gs_weather_info.on_command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">block</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_weather_msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bot: Bot, ev: Event):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 获取用户输入的城市，如果为空，做出提醒，并用return中断函数运行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ev.text.strip()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 创建一个请求客户端</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> httpx.AsyncClient()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 如果用户没有输入任何参数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 进行检查是否有绑定</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        uuid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WeatherBind.get_uid_by_game(ev.user_id, ev.bot_id)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 如果连绑定都没有，则提醒用户</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uuid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;请输入城市名称，或使用 tq城市绑定 命令！&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 存在UUID的绑定，则我们进行分割</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 别忘了我们绑定的时候，UUID的值是 城市名|城市ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pos_id, pos_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uuid.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;|&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 有输入参数则直接使用用户输入</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 根据用户传入的信息，请求城市ID和城市完整名称</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ev是当前事件的一系列可用信息，例如ev.text就是去除了命令之后的用户输入</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 例如用户输入 天气漳州 ，ev.text = 漳州</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 要获取完整用户输入，ev.raw_text = 天气漳州，ev.command = 天气</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pos_resp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.get(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;https://geoapi.qweather.com/v2/city/lookup&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: text,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 解析结果为pyhon中的字典</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pos_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_resp.json()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 获取结果中的响应代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pos_retcode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 响应码不为200则发生了报错，我们把错误码返回给用户，便于定位错误信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_retcode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;200&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[天气] 获取天气信息失败！错误码为 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pos_retcode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 城市ID，就是要用这个ID请求下面的天气信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            pos_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            pos_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 再进行一次请求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    weather_resp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.get(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;https://devapi.qweather.com/v7/weather/now&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: pos_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    weather_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_resp.json()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    weather_retcode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 错误码处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;200&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[天气] 获取天气信息失败！错误码为 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">weather_retcode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">！&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 现在温度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        now_temp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;now&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;temp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 现在的体感温度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        now_feels </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;now&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;feelsLike&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 城市名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pos_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weather_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 将结果进行字符串拼贴，便于把最后的结果呈现给用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pos_name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">的天气是：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">now_temp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">度, 体感温度为: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">now_feels</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">度！&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bot.send(text)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><ol start="7"><li>主要功能已经全部完成，可以运行机器人体验一下。</li></ol><div class="panel-view"><div class="controls"><div class="circle red"></div><div class="circle yellow"></div><div class="circle green"></div><div class="title"><span class="title-text">聊天界面</span></div></div><div class="content"><!--[--><div class="chat-message"><img class="avatar" src="https://s2.loli.net/2023/10/05/GHjJNWBP4nezgIU.png"><div class="nickname">Wuyi无疑 <span class="VPBadge danger" data-v-d01e489a><!--[-->用户<!--]--></span></div><div class="message-box"><!--[-->天气<!--]--></div></div><div class="chat-message"><img class="avatar" src="https://s2.loli.net/2023/03/25/bareSdYcsmRPOyZ.png"><div class="nickname">GsCore <span class="VPBadge tip" data-v-d01e489a><!--[-->机器人<!--]--></span></div><div class="message-box"><!--[-->请输入城市名称，或使用 tq城市绑定 命令！<!--]--></div></div><div class="chat-message"><img class="avatar" src="https://s2.loli.net/2023/10/05/GHjJNWBP4nezgIU.png"><div class="nickname">Wuyi无疑 <span class="VPBadge danger" data-v-d01e489a><!--[-->用户<!--]--></span></div><div class="message-box"><!--[-->tq城市绑定漳州<!--]--></div></div><div class="chat-message"><img class="avatar" src="https://s2.loli.net/2023/03/25/bareSdYcsmRPOyZ.png"><div class="nickname">GsCore <span class="VPBadge tip" data-v-d01e489a><!--[-->机器人<!--]--></span></div><div class="message-box"><!--[-->绑定城市 漳州 成功！<!--]--></div></div><div class="chat-message"><img class="avatar" src="https://s2.loli.net/2023/10/05/GHjJNWBP4nezgIU.png"><div class="nickname">Wuyi无疑 <span class="VPBadge danger" data-v-d01e489a><!--[-->用户<!--]--></span></div><div class="message-box"><!--[-->天气<!--]--></div></div><div class="chat-message"><img class="avatar" src="https://s2.loli.net/2023/03/25/bareSdYcsmRPOyZ.png"><div class="nickname">GsCore <span class="VPBadge tip" data-v-d01e489a><!--[-->机器人<!--]--></span></div><div class="message-box"><!--[-->漳州的天气是：41度, 体感温度为: 37度！<!--]--></div></div><!--]--></div></div><h2 id="_6、增强部署者体验" tabindex="-1">6、增强部署者体验 <a class="header-anchor" href="#_6、增强部署者体验" aria-label="Permalink to &quot;6、增强部署者体验&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>如果这个插件只是给自己用的，那么在上一步已经结束了。</p><p>但是如果你想发到Git上，为了方便自己和其他部署者，你还需要额外再做一些操作！</p></div><h3 id="将数据库映射至网页控制台" tabindex="-1">将数据库映射至网页控制台 <a class="header-anchor" href="#将数据库映射至网页控制台" aria-label="Permalink to &quot;将数据库映射至网页控制台&quot;">​</a></h3><ol><li>将数据库映射至网页控制台, 在<code>database.py</code>中新增代码如下：</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.webconsole.mount_app </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PageSchema, GsAdminModel, site</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注册网页控制台的类</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@site.register_admin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WeatherBindadmin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GsAdminModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pk_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;id&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    page_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PageSchema(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;天气绑定管理&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        icon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fa fa-users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># type: ignore</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 配置管理模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WeatherBind</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><img src="/assets/image-20240609020855870.b9-fmbAd.png" alt="image-20240609020855870"><ol start="2"><li>重启Gscore，打开网页控制台，输入账密登录之后，发现已经映射成功！</li></ol><img src="/assets/image-20240609021121756.C2r_WlKk.png" alt="image-20240609021121756"><h3 id="将key配置持久化并映射至网页控制台" tabindex="-1">将Key配置持久化并映射至网页控制台 <a class="header-anchor" href="#将key配置持久化并映射至网页控制台" aria-label="Permalink to &quot;将Key配置持久化并映射至网页控制台&quot;">​</a></h3><p>还记得吗，在编写命令的时候我们将<code>KEY = &#39;dc3fe7eb3fab424a8c91901bd8894aa9&#39;</code>写入了<code>__init__.py</code>中，方便后续程序调用key，但是这么做有几个显著的缺点：</p><ol><li>当你上传至Git的时候，很可能忘记<strong>脱敏</strong>，导致将自己的Key上传至公众平台</li><li>别人部署后，修改Key即为修改代码文件，为后续<code>git pull</code>带来不便</li><li>每次修改都要修改代码文件，不如<strong>独立成配置化文件</strong></li></ol><p>那在GsCore中进行插件的<strong>独立配置</strong>，并不复杂，利用预先设定的方法，可以<strong>轻松实现</strong>！</p><ol><li>我们新建一个文件，叫<code>config.py</code>，在里面进行编写。</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 先导入基础配置模型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Dict</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 导包</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.data_store </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_res_path</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 然后添加到GsCore网页控制台中</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.utils.plugins_config.gs_config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StringConfig</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gsuid_core.utils.plugins_config.models </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    GSC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GsStrConfig,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 建立自己插件的CONFIG_DEFAULT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 名字无所谓, 类型一定是Dict[str, GSC]，以下为示例，可以添加无数个配置</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONIFG_DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: Dict[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GSC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;tq_key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: GsStrConfig(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;天气源Key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这个是该配置的名称</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;如果没有，需要自己申请&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这个是该配置的详细介绍</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这个是该配置的默认参数，这里我们直接为空即可</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设定一个配置文件（json）保存文件路径</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这里get_res_path()的作用是定位到 gsuid_core/data路径下</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONFIG_PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_res_path(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Gs_Weather&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;config.json&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 上面的路径为 gsuid_core/data/Gs_Weather/config.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 分别传入 配置总名称（不要和其他插件重复），配置路径，以及配置模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tq_config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StringConfig(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GsWeather&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONFIG_PATH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONIFG_DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ol start="2"><li>然后在<code>__init__</code>中引用该配置<code>tq_config</code>， 代码修改如下：</li></ol><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 相对引用上面定义的配置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tq_config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># KEY直接调用配置项，配置名称要填入，然后引用data属性</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tq_config.get_config(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tq_key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).data</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>这样就大功告成了，后续我们需要填入Key的话，可以有两个方法： <ul><li>直接修改<code>gsuid_core/data/Gs_Weather/config.json</code>文件</li><li>或者打开网页控制台，你会发现已经有了对应的配置项</li></ul></li></ol><img src="/assets/image-20240609022134459.DMxl3PY2.png" alt="image-20240609022134459"><h2 id="_7、其他问题" tabindex="-1">7、其他问题 <a class="header-anchor" href="#_7、其他问题" aria-label="Permalink to &quot;7、其他问题&quot;">​</a></h2><p>遗留下来的其他问题，解决方案就留给你们自己补充思考了：</p><ul><li>天气API的访问在<code>__init__.py</code>中出现了两次，能否封装为一个函数，方便调用？</li><li>在绑定城市的时候，并没有二次确认，万一API请求到了一个很离谱的城市，将会直接绑定成功，造成困扰。</li><li>可否添加按钮，方便用户调用？</li><li>帮助功能？</li><li>定时天气推送？</li><li>插件上传商店？</li><li><code>天气</code>命令返回图片？</li></ul></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><!----><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2024-08-18T17:49:32.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/CodePlugins/Start.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>上一篇</span><span class="title" data-v-e257564d>✨ 简单介绍</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/CodePlugins/Env.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>下一篇</span><span class="title" data-v-e257564d>VsCode配置</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>支持多个Bot框架和多种平台的微服务，欢迎 <a target="_blank" style="color: var(--vp-c-brand)" href="https://github.com/Genshin-bots/gsuid_core">star ⭐</a> 让更多人发现</p><p class="copyright" data-v-e315a0ad><a target="_blank" href="https://github.com/Genshin-bots/gsuid_core/blob/main/LICENSE">GPL v3 License</a> | Theme by <a target="_blank" href="https://github.com/Genshin-bots/gsuid_core">GsCore</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"advance_baseinfo.md\":\"BnZoCanm\",\"advance_binddevice.md\":\"DbvuuqQC\",\"advance_coreconfig.md\":\"t6VfXoEI\",\"advance_datastruct.md\":\"DEoBLv-m\",\"advance_exportandimport.md\":\"bJfu-cqj\",\"advance_httpcall.md\":\"ro7upvHN\",\"advance_markdowntemplate.md\":\"DRZW5evs\",\"advance_transurl.md\":\"ycUuBSIc\",\"advance_webconsole.md\":\"DCan53PJ\",\"codeadapter_pack.md\":\"BNxIj4F5\",\"codeadapter_protocol.md\":\"CHDqMqJ5\",\"codeplugins_botcall.md\":\"CfBogIa4\",\"codeplugins_class.md\":\"BwuQXypP\",\"codeplugins_cookbook.md\":\"DK-gTg6O\",\"codeplugins_env.md\":\"B0z3vU-J\",\"codeplugins_exsample.md\":\"DFidKs8b\",\"codeplugins_getdatapath.md\":\"C3JRwj8h\",\"codeplugins_getpluginsconfig.md\":\"Fw72GvXS\",\"codeplugins_pluginsconfig.md\":\"Bd0oJYIz\",\"codeplugins_pluginsdatabase.md\":\"D-TZx5iX\",\"codeplugins_resp.md\":\"D5RD_7ca\",\"codeplugins_scheduler.md\":\"DALoL4q4\",\"codeplugins_simple.md\":\"7fLPiybm\",\"codeplugins_start.md\":\"5JIChcMK\",\"codeplugins_trigger.md\":\"B8uUHiTq\",\"extra_addck.md\":\"C9qY5m9I\",\"extra_faq.md\":\"CH7jy7N7\",\"extra_resourcedownload.md\":\"BVSHwFjw\",\"faq_index.md\":\"COt442jA\",\"index.md\":\"B0UTxBrG\",\"installplugins_installplugins.md\":\"DVtPTylO\",\"installplugins_pluginslist.md\":\"BdiTjvrE\",\"linkbots_adapterlist.md\":\"CAQ-SnfA\",\"linkbots_hoshinobot.md\":\"B6jzAZAj\",\"linkbots_nonebot2.md\":\"DxH2K5F1\",\"pluginshelp_arknightsuid.md\":\"bQn7m3yR\",\"pluginshelp_bluearchiveuid.md\":\"BpCVK3pZ\",\"pluginshelp_genshinuid.md\":\"MNvz9W-a\",\"pluginshelp_lolegendsuid.md\":\"C0q6Azii\",\"pluginshelp_majsouluid.md\":\"BcGZW5Kx\",\"pluginshelp_starrailuid.md\":\"CGYJmF6T\",\"pluginshelp_wzryuid.md\":\"Crh96Re_\",\"pluginshelp_zzzerouid.md\":\"BV2zGzqq\",\"started_coreconfig.md\":\"DNSNpsXU\",\"started_envcheck.md\":\"CSQjw0_t\",\"started_installcore.md\":\"BYU7wRQf\",\"started_startcore.md\":\"DgT3wQ4f\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"早柚核心Docs\",\"description\":\"安装早柚核心、了解早柚协议、编写GsCore插件，早柚核心，一个可以连接多个Bot和适配多个平台的Python Bot框架。\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/favicon.ico\",\"outline\":2,\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"returnToTopLabel\":\"返回顶部\",\"outlineTitle\":\"导航栏\",\"darkModeSwitchLabel\":\"外观\",\"sidebarMenuLabel\":\"归档\",\"footer\":{\"message\":\"支持多个Bot框架和多种平台的微服务，欢迎 <a target=\\\"_blank\\\" style=\\\"color: var(--vp-c-brand)\\\" href=\\\"https://github.com/Genshin-bots/gsuid_core\\\">star ⭐</a> 让更多人发现\",\"copyright\":\"<a target=\\\"_blank\\\" href=\\\"https://github.com/Genshin-bots/gsuid_core/blob/main/LICENSE\\\">GPL v3 License</a> | Theme by <a target=\\\"_blank\\\" href=\\\"https://github.com/Genshin-bots/gsuid_core\\\">GsCore</a>\"},\"nav\":[{\"text\":\"🎉 快速开始\",\"items\":[{\"text\":\"⭐ 安装Core\",\"link\":\"/Started/InstallCore\"},{\"text\":\"🤖 链接Bot\",\"link\":\"/LinkBots/AdapterList\"},{\"text\":\"🔧 安装插件\",\"link\":\"/InstallPlugins/InstallPlugins\"},{\"text\":\"✅ 绑定账号\",\"link\":\"/Advance/BindDevice\"},{\"text\":\"💫 常见问题\",\"link\":\"/FAQ/\"},{\"text\":\"💻 编写插件\",\"link\":\"/CodePlugins/Start\"},{\"text\":\"🧐 编写适配器\",\"link\":\"/CodeAdapter/Pack\"}]},{\"text\":\"💖 系列插件\",\"items\":[{\"text\":\"✨ GenshinUID\",\"link\":\"https://github.com/KimigaiiWuyi/GenshinUID\"},{\"text\":\"🚅 StarRailUID\",\"link\":\"https://github.com/baiqwerdvd/StarRailUID\"},{\"text\":\"🎮 WzryUID\",\"link\":\"https://github.com/KimigaiiWuyi/WzryUID\"},{\"text\":\"🛶 ArknightsUID\",\"link\":\"https://github.com/baiqwerdvd/ArknightsUID/\"},{\"text\":\"🏫 BlueArchiveUID\",\"link\":\"https://github.com/KimigaiiWuyi/BlueArchiveUID\"},{\"text\":\"🀄 MajsoulUID\",\"link\":\"https://github.com/KimigaiiWuyi/MajsoulUID\"},{\"text\":\"🦸‍♂️ LOLegendsUID\",\"link\":\"https://github.com/KimigaiiWuyi/LOLegendsUID\"},{\"text\":\"🧿 ZZZeroUID\",\"link\":\"https://github.com/ZZZure/ZZZeroUID\"},{\"text\":\"⏩ 更多插件\",\"link\":\"/InstallPlugins/PluginsList\"}]},{\"text\":\"v0.2.1\",\"items\":[{\"text\":\"📝 文档地址\",\"link\":\"https://github.com/Genshin-bots/GenshinUID-docs\"},{\"text\":\"📦️ GsCore地址\",\"link\":\"https://github.com/Genshin-bots/gsuid_core\"},{\"text\":\"🐧 QQ群: Mihomo Group\",\"link\":\"https://qm.qq.com/cgi-bin/qm/qr?k=d1oNQ1wePPbCkhPbP3vZN-DsXDD0hG61&authKey=0PdxKz%2BMbWgy7kwcF9OB%2B%2BrgOWKuREFG6tgJuWpr%2BzN8gtBTlGR6wDbk6N0W3bL1&noverify=0&group_code=929275476\"}]}],\"sidebar\":{\"/\":[{\"text\":\"🚀 快速开始\",\"collapsed\":true,\"items\":[{\"text\":\"确认环境\",\"link\":\"/Started/EnvCheck\"},{\"text\":\"安装GsCore\",\"link\":\"/Started/InstallCore\"},{\"text\":\"启动GsCore\",\"link\":\"/Started/StartCore\"},{\"text\":\"配置GsCore\",\"link\":\"/Started/CoreConfig\"}]},{\"text\":\" 🤖 链接支持Bot\",\"collapsed\":true,\"items\":[{\"text\":\"NoneBot2\",\"link\":\"/LinkBots/NoneBot2\"},{\"text\":\"HoshinoBot\",\"link\":\"/LinkBots/HoshinoBot\"},{\"text\":\"适配Bot列表\",\"link\":\"/LinkBots/AdapterList\"}]},{\"text\":\"🔧 安装插件\",\"collapsed\":true,\"items\":[{\"text\":\"安装插件\",\"link\":\"/InstallPlugins/InstallPlugins\"},{\"text\":\"插件列表\",\"link\":\"/InstallPlugins/PluginsList\"}]},{\"text\":\" 🚀 进阶介绍\",\"collapsed\":true,\"items\":[{\"text\":\"概念理解\",\"link\":\"/Advance/BaseInfo\"},{\"text\":\"数据存储结构\",\"link\":\"/Advance/DataStruct\"},{\"text\":\"网页控制台\",\"link\":\"/Advance/WebConsole\"},{\"text\":\"常见问题\",\"link\":\"/FAQ/\"},{\"text\":\"绑定账号\",\"link\":\"/Advance/BindDevice\"},{\"text\":\"转URL图片发送\",\"link\":\"/Advance/TransURL\"},{\"text\":\"MD模板和按钮模板\",\"link\":\"/Advance/MarkdownTemplate\"},{\"text\":\"Core配置项\",\"link\":\"/Advance/CoreConfig\"},{\"text\":\"HTTP调用\",\"link\":\"/Advance/HTTPCall\"}]},{\"text\":\" 🔍️ 编写插件\",\"collapsed\":true,\"items\":[{\"text\":\"✨ 简单介绍\",\"link\":\"/CodePlugins/Start\"},{\"text\":\"🔥 插件开发指南\",\"link\":\"/CodePlugins/CookBook\"},{\"text\":\"VsCode配置\",\"link\":\"/CodePlugins/Env\"},{\"text\":\"简单示例\",\"link\":\"/CodePlugins/Simple\"},{\"text\":\"简单参考\",\"link\":\"/CodePlugins/Exsample\"},{\"text\":\"定时任务\",\"link\":\"/CodePlugins/Scheduler\"},{\"text\":\"调用资源目录\",\"link\":\"/CodePlugins/GetDataPath\"},{\"text\":\"提供配置项\",\"link\":\"/CodePlugins/PluginsConfig\"},{\"text\":\"调用配置项\",\"link\":\"/CodePlugins/GetPluginsConfig\"},{\"text\":\"调用数据库\",\"link\":\"/CodePlugins/PluginsDataBase\"},{\"text\":\"多步会话\",\"link\":\"/CodePlugins/Resp\"},{\"text\":\"任意位置调用Bot\",\"link\":\"/CodePlugins/BotCall\"},{\"text\":\"模块方法\",\"link\":\"/CodePlugins/Class\"}]},{\"text\":\" 🧐 编写适配器\",\"collapsed\":true,\"items\":[{\"text\":\"早柚协议\",\"link\":\"/CodeAdapter/Protocol\"},{\"text\":\"数据结构\",\"link\":\"/CodeAdapter/Pack\"}]},{\"text\":\" 📄 插件帮助\",\"collapsed\":true,\"items\":[{\"text\":\"GenshinUID\",\"link\":\"/PluginsHelp/GenshinUID\"},{\"text\":\"StarRailUID\",\"link\":\"/PluginsHelp/StarRailUID\"},{\"text\":\"ArknightsUID\",\"link\":\"/PluginsHelp/ArknightsUID\"},{\"text\":\"BlueArchiveUID\",\"link\":\"/PluginsHelp/BlueArchiveUID\"},{\"text\":\"WzryUID\",\"link\":\"/PluginsHelp/WzryUID\"},{\"text\":\"MajsoulUID\",\"link\":\"/PluginsHelp/MajsoulUID\"},{\"text\":\"LOLegendsUID\",\"link\":\"/PluginsHelp/LOLegendsUID\"},{\"text\":\"ZZZeroUID\",\"link\":\"/PluginsHelp/ZZZeroUID\"}]}]}},\"locales\":{\"root\":{\"label\":\"简体中文\",\"lang\":\"zh-CN\"}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>